input {
    file {
        path => "c:/elk-workshop/logstash/pipelines/httpd/data/access.mini.log"
        start_position => beginning
        codec => plain
        sincedb_path => "c:/elk-workshop/logstash/pipelines/httpd/access.mini.sincedb"
    }
}

filter {
    grok {
        match => {
            "message" => "%{COMBINEDAPACHELOG}"
        }
    }
    # Add a geoip filter here
    # In the COMMONAPACHELOG and COMBINEDAPACHELOG formats
    # the client IP or host name is placed in the field "clientip"
    # Specify the geoip fields you want to keep, but remember to include the "location" field
    geoip {
        source => "clientip"
        fields => ["city_name", "country_name", "location"]
    }
    
    # Add a date filter to convert the timestamp field to the special @timestamp field
    date {
        match => ["timestamp", "dd/MMM/YYYY:HH:mm:ss Z"]
        remove_field => ["timestamp"]
    }
}

output {
    stdout {
        codec => rubydebug
    }
}
